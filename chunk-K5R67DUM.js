import{a as E}from"./chunk-PMXTTDMO.js";import{a as T}from"./chunk-QZF37CAG.js";import{e as g}from"./chunk-5OT4C6C4.js";import{b as F,c as m,d as b,e as S,i as _,j as y,k as w,l as C,m as V,n as N,o as j,p as x,r as A}from"./chunk-LY3SBGMY.js";import{g as G}from"./chunk-NPRT3BWK.js";import{$a as l,Ea as s,Ia as v,Na as f,Ua as W,Va as D,Xa as M,Ya as k,Za as h,_a as t,ab as d,kb as p,mb as P,sb as n,tb as L,ub as B,wa as c}from"./chunk-GCAN2TPR.js";function K(o,i){o&1&&(t(0,"select",10)(1,"option",11),n(2,"VOLVO"),l(),t(3,"option",12),n(4,"DAF"),l(),t(5,"option",13),n(6,"IVECO"),l()())}function J(o,i){o&1&&(t(0,"select",14)(1,"option",15),n(2,"SCHMITZ"),l(),t(3,"option",16),n(4,"OTHER"),l()())}function Q(o,i){o&1&&(t(0,"div",17),n(1," Please write number! For example: PZ1R741 "),l())}var O=class o{constructor(i,e,r,a,u){this.fb=i;this.firebase=e;this.alertService=r;this.vehicleFleetService=a;this.waybill=u;this.vehicleForm=this.fb.group({vehicleBrand:["volvo",m.required],vehicleType:["truck",m.required],vehicleTrailerBrand:["schmitz",m.required],vehicleNumber:["",[m.required,m.minLength(6)]]})}isOpen=!1;vehicleForm;curentType=!1;vehicleFleetArray=[];onTypeChange(i){let e=i.target.value;this.curentType=e==="trailer"}async onSubmit(){if(this.vehicleFleetArray=await this.vehicleFleetService.getVehicleFleet(),this.vehicleForm.valid){let{vehicleBrand:i,vehicleType:e,vehicleTrailerBrand:r,vehicleNumber:a}=this.vehicleForm.value;if(this.vehicleFleetArray.find(u=>u.vehicle_number==a.toUpperCase())){this.alertService.show("error","Vehicle already exists"),console.log("Vehicle already exists");return}else this.curentType?await this.firebase.addVehicleFleet(a.toUpperCase(),e,r):await this.firebase.addVehicleFleet(a.toUpperCase(),e,i),this.vehicleForm.get("vehicleNumber")?.reset(),this.alertService.show("success","Vehicle added successfully")}else console.log(this.vehicleForm.errors),this.alertService.show("error","Form invalid");this.waybill.setIsOpenModalFormForAddNewVehicle()}static \u0275fac=function(e){return new(e||o)(s(x),s(g),s(T),s(E),s(I))};static \u0275cmp=v({type:o,selectors:[["app-add-new-vehicle"]],decls:17,vars:4,consts:[[1,"add-new-vehicle"],[3,"ngSubmit","formGroup"],["formControlName","vehicleType",3,"change"],["value","trailer"],["value","truck"],["formControlName","vehicleBrand",4,"ngIf"],["formControlName","vehicleTrailerBrand",4,"ngIf"],["type","text","placeholder","Write Number","formControlName","vehicleNumber","minlength","6"],["class","error",4,"ngIf"],["type","submit",1,"btn"],["formControlName","vehicleBrand"],["value","volvo"],["value","daf"],["value","iveco"],["formControlName","vehicleTrailerBrand"],["value","schmitz"],["value","other"],[1,"error"]],template:function(e,r){if(e&1&&(t(0,"section",0)(1,"h1"),n(2,"Add new vehicle"),l(),t(3,"form",1),p("ngSubmit",function(){return r.onSubmit()}),t(4,"select",2),p("change",function(u){return r.onTypeChange(u)}),t(5,"option",3),n(6,"TRAILER"),l(),t(7,"option",4),n(8,"TRUCK"),l()(),d(9,"br"),f(10,K,7,0,"select",5),d(11,"br"),f(12,J,5,0,"select",6),d(13,"input",7),f(14,Q,2,0,"div",8),t(15,"button",9),n(16,"SAVE"),l()()()),e&2){let a;c(3),h("formGroup",r.vehicleForm),c(7),h("ngIf",!r.curentType),c(2),h("ngIf",r.curentType),c(2),h("ngIf",((a=r.vehicleForm.get("vehicleNumber"))==null?null:a.touched)&&((a=r.vehicleForm.get("vehicleNumber"))==null?null:a.invalid))}},dependencies:[A,_,V,N,F,C,b,S,j,w,y,G],styles:[".add-new-vehicle[_ngcontent-%COMP%]{width:400px;max-width:100%;height:100%;background:#1c69af;padding:10px;display:flex;flex-direction:column;align-content:center;align-items:center;border:2px solid white}.add-new-vehicle[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;height:100vh;background:beige;top:0;left:0;position:absolute;flex-direction:column;align-content:center;align-items:center;width:100%;z-index:100}select[_ngcontent-%COMP%], input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{margin-top:30px;width:90%;height:50px;background:var(--dark-color);color:var(--primary-color);margin-bottom:10px}"]})};var q=(o,i)=>i.id;function Y(o,i){if(o&1&&(t(0,"app-add-new-vehicle"),n(1),l()),o&2){let e=P();c(),L(e.isOpenModalFormForAddNewVehicle)}}function ee(o,i){if(o&1&&(t(0,"option"),n(1),l()),o&2){let e=i.$implicit;c(),B(" ",e.vehicle_number," ")}}function te(o,i){if(o&1&&(t(0,"option"),n(1),l()),o&2){let e=i.$implicit;c(),B(" ",e.vehicle_number," ")}}var I=class o{constructor(i,e,r,a){this.alertService=i;this.vehicleFleetService=e;this.fb=r;this.formBuilder=a;this.form=this.formBuilder.group({dataStart:["",[m.required]],dataFinish:["",[m.required]],truck:["",m.required],trailer:["",m.required],notes:[""]},{validators:this.finishAfterStartValidator})}vehicleFleetList={trucks:[],trailers:[]};form;isOpenModalFormForAddNewVehicle=!1;async ngOnInit(){(await this.vehicleFleetService.loadVehicleFleet()).forEach(e=>{e.type==="truck"?this.vehicleFleetList.trucks.push(e):this.vehicleFleetList.trailers.push(e)}),this.form.patchValue({truck:this.vehicleFleetList.trucks[0]?.vehicle_number||"",trailer:this.vehicleFleetList.trailers[0]?.vehicle_number||""}),console.log("Vehicle list:",this.vehicleFleetList)}finishAfterStartValidator(i){let e=i.get("dataStart")?.value,r=i.get("dataFinish")?.value;if(!e||!r)return null;let a=new Date(e);return new Date(r)<a?{finishBeforeStart:!0}:null}onSubmit(){this.form.valid?this.fb.addInfoForCurrentUser(this.form.value).then(()=>{this.alertService.show("success","Waybill saved successfully"),this.form.reset()}).catch(()=>{this.alertService.show("error","Error saving waybill:")}):(this.alertService.show("error",`Form invalid ${this.form.errors}`),this.form.markAllAsTouched())}get dataStart(){return this.form.get("dataStart")}get dataFinish(){return this.form.get("dataFinish")}get truck(){return this.form.get("truck")}get trailer(){return this.form.get("trailer")}setIsOpenModalFormForAddNewVehicle(){this.isOpenModalFormForAddNewVehicle=!this.isOpenModalFormForAddNewVehicle}addTrailer(i){i==="add"&&(this.isOpenModalFormForAddNewVehicle=!0)}static \u0275fac=function(e){return new(e||o)(s(T),s(E),s(g),s(x))};static \u0275cmp=v({type:o,selectors:[["app-waybill"]],decls:27,vars:2,consts:[[1,"formWaybill",3,"ngSubmit","formGroup"],["for","truck"],["name","truck","formControlName","truck",3,"change"],["value","add"],["for","trailer"],["name","trailer","formControlName","trailer",3,"change"],["formControlName","dataStart","type","datetime-local"],["formControlName","dataFinish","type","datetime-local"],["formControlName","notes","name","","id","","cols","30","rows","10","placeholder","Notes"],["type","submit",1,"btn"]],template:function(e,r){e&1&&(t(0,"form",0),p("ngSubmit",function(){return r.onSubmit()}),t(1,"h2"),n(2,"Waybill"),l(),W(3,Y,2,1,"app-add-new-vehicle"),t(4,"label",1),n(5,"Truck:"),l(),t(6,"select",2),p("change",function(){return r.addTrailer(r.form.value.truck)}),M(7,ee,2,1,"option",null,q),t(9,"option",3),n(10," add "),l()(),t(11,"label",4),n(12,"Trailer:"),l(),t(13,"select",5),p("change",function(){return r.addTrailer(r.form.value.trailer)}),M(14,te,2,1,"option",null,q),t(16,"option",3),n(17," add "),l()(),t(18,"label"),n(19," Start: "),d(20,"input",6),l(),t(21,"label"),n(22," Finish: "),d(23,"input",7),l(),d(24,"textarea",8),t(25,"button",9),n(26,"SAVE"),l()()),e&2&&(h("formGroup",r.form),c(3),D(r.isOpenModalFormForAddNewVehicle?3:-1),c(4),k(r.vehicleFleetList.trucks),c(7),k(r.vehicleFleetList.trailers))},dependencies:[A,_,V,N,F,C,b,S,w,y,O],styles:[".formWaybill[_ngcontent-%COMP%]{width:80vw;max-width:600px;height:70vh;background:#1c69af;border:2px solid white;padding:10px;border-radius:8px;margin:10px auto;display:flex;flex-direction:column;align-items:stretch;justify-content:center;color:#fff;font-size:18px}h2[_ngcontent-%COMP%]{text-align:center}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{margin-bottom:20px;margin-top:5px;width:100%;height:30px}textarea[_ngcontent-%COMP%]{margin-bottom:30px}"]})};export{I as Waybill};
